<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Macha Viewer</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; display: flex; height: 100vh; }
#sidebar { width: 280px; min-width: 280px; background: #f8f9fa; border-right: 1px solid #dee2e6; display: flex; flex-direction: column; }
#search { padding: 12px; border: none; border-bottom: 1px solid #dee2e6; font-size: 14px; outline: none; background: #fff; }
#search:focus { box-shadow: inset 0 -2px 0 #0d6efd; }
#file-list { list-style: none; overflow-y: auto; flex: 1; }
#file-list li { padding: 10px 12px; cursor: pointer; border-bottom: 1px solid #eee; font-size: 13px; }
#file-list li:hover { background: #e9ecef; }
#file-list li.active { background: #0d6efd; color: #fff; }
#file-list li.active .badge { background: #fff; color: #333; }
.badge { display: inline-block; font-size: 11px; padding: 2px 6px; border-radius: 3px; margin-left: 6px; font-weight: 500; }
.badge-strong { background: #d4edda; color: #155724; }
.badge-good { background: #cce5ff; color: #004085; }
.badge-moderate { background: #fff3cd; color: #856404; }
.badge-stretch { background: #f8d7da; color: #721c24; }
#content { flex: 1; overflow-y: auto; padding: 32px 48px; }
#content h1 { margin-bottom: 16px; color: #212529; }
#content h2 { margin-top: 24px; margin-bottom: 12px; color: #495057; border-bottom: 1px solid #dee2e6; padding-bottom: 6px; }
#content p { margin-bottom: 12px; line-height: 1.6; color: #333; }
#content ul, #content ol { margin-bottom: 12px; padding-left: 24px; }
#content li { margin-bottom: 4px; line-height: 1.5; }
#content a { color: #0d6efd; }
#content strong { color: #212529; }
.title-text { display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
#count { padding: 8px 12px; font-size: 12px; color: #6c757d; border-bottom: 1px solid #dee2e6; }
</style>
</head>
<body>
<div id="sidebar">
  <input id="search" type="text" placeholder="Filter applications..." />
  <div id="count"></div>
  <ul id="file-list"></ul>
</div>
<div id="content">
  <p style="color:#6c757d;margin-top:40vh;text-align:center">Select an application from the sidebar</p>
</div>
<script>
let allFiles = [];
const list = document.getElementById('file-list');
const content = document.getElementById('content');
const search = document.getElementById('search');
const countEl = document.getElementById('count');

function badgeClass(fit) {
  const f = fit.toLowerCase();
  if (f.includes('strong')) return 'badge-strong';
  if (f.includes('good')) return 'badge-good';
  if (f.includes('moderate')) return 'badge-moderate';
  return 'badge-stretch';
}

function renderList(files) {
  list.innerHTML = '';
  countEl.textContent = files.length + ' application' + (files.length !== 1 ? 's' : '');
  files.forEach(f => {
    const li = document.createElement('li');
    li.dataset.filename = f.filename;
    const badge = f.fit ? '<span class="badge ' + badgeClass(f.fit) + '">' + f.fit + '</span>' : '';
    li.innerHTML = '<span class="title-text">' + escapeHtml(f.title) + badge + '</span>';
    li.onclick = () => loadFile(f.filename, li);
    list.appendChild(li);
  });
}

function escapeHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

async function loadFile(filename, li) {
  document.querySelectorAll('#file-list li').forEach(el => el.classList.remove('active'));
  if (li) li.classList.add('active');
  const res = await fetch('/api/file/' + encodeURIComponent(filename));
  content.innerHTML = await res.text();
}

search.addEventListener('input', () => {
  const q = search.value.toLowerCase();
  const filtered = allFiles.filter(f => f.title.toLowerCase().includes(q) || f.fit.toLowerCase().includes(q));
  renderList(filtered);
});

fetch('/api/files').then(r => r.json()).then(files => {
  allFiles = files.sort((a, b) => a.title.localeCompare(b.title));
  renderList(allFiles);
});
</script>
</body>
</html>
